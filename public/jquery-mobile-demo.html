<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>jQuery Mobile API Demo</title>
    <link rel="stylesheet" href="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" />
    <script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
    <script src="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
    <style>
        /* 自定義樣式 */
        .container { padding: 1em; }
        .response-box {
            margin-top: 1em;
            padding: 1em;
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: monospace;
            min-height: 100px;
        }
        .error-response {
            color: red;
            border-color: red;
        }
    </style>
</head>
<body>

<div data-role="page" id="page-echo">
    <div data-role="header" data-theme="b">
        <h1>Echo Message (GET)</h1>
    </div><div role="main" class="ui-content container">
        <label for="echoInput">輸入訊息:</label>
        <input type="text" id="echoInput" value="Hello from jQuery Mobile!">
        <a href="#" class="ui-btn ui-btn-b" onclick="testEchoMessage()">發送 GET 請求</a>
        <h3>回應:</h3>
        <div id="echoResponse" class="response-box">等待發送...</div>
    </div><div data-role="footer" data-theme="b">
        <h4>頁腳</h4>
    </div></div><div data-role="page" id="page-reverse">
    <div data-role="header" data-theme="b">
        <a href="#page-echo" data-icon="arrow-l" data-rel="back" data-direction="reverse">返回</a>
        <h1>Reverse Message (POST)</h1>
    </div><div role="main" class="ui-content container">
        <label for="reverseInput">輸入要反轉的訊息:</label>
        <input type="text" id="reverseInput" value="jQuery is great">
        <a href="#" class="ui-btn ui-btn-b" onclick="testReverseMessage()">發送 POST 請求</a>
        <h3>回應:</h3>
        <div id="reverseResponse" class="response-box">等待發送...</div>
    </div><div data-role="footer" data-theme="b">
        <h4>頁腳</h4>
    </div></div><script type="module" src="./ajax/apiProxy.js"></script>

<script type="module">
    // 從 apiProxy.js 模組導入 apiProxy 物件
    import { apiProxy } from './ajax/apiProxy.js';

    // 將 API 呼叫函數綁定到 window 物件，以便在 onclick 事件中存取
    window.testEchoMessage = async () => {
        const message = $('#echoInput').val();
        const responseDiv = $('#echoResponse');
        responseDiv.removeClass('error-response').text('載入中...');

        try {
            // 使用 apiProxy 呼叫 echomsg API
            const response = await apiProxy.echomsg(message);
            responseDiv.text(JSON.stringify(response, null, 2));
        } catch (error) {
            console.error('Echo API 呼叫失敗:', error);
            const errorMessage = `錯誤: ${error.message}\n${JSON.stringify(error.response?.data, null, 2) || ''}`;
            responseDiv.addClass('error-response').text(errorMessage);
        }
    };

    window.testReverseMessage = async () => {
        const message = $('#reverseInput').val();
        const responseDiv = $('#reverseResponse');
        responseDiv.removeClass('error-response').text('載入中...');

        try {
            // 使用 apiProxy 呼叫 reversemmsg API
            const response = await apiProxy.reversemmsg(message);
            responseDiv.text(JSON.stringify(response, null, 2));
        } catch (error) {
            console.error('Reverse API 呼叫失敗:', error);
            const errorMessage = `錯誤: ${error.message}\n${JSON.stringify(error.response?.data, null, 2) || ''}`;
            responseDiv.addClass('error-response').text(errorMessage);
        }
    };

    // 透過 jQuery Mobile 的 pagecreate 事件來執行初始化邏輯
    $(document).on("pagecreate", "#page-echo", function() {
        console.log("Page Echo created!");
    });
    
    $(document).on("pagecreate", "#page-reverse", function() {
        console.log("Page Reverse created!");
    });
    
    // jQuery Mobile 會自動處理頁面導航，您只需要確保 data-role="page" 的 div 之間有連結即可
    // 這裡的連結是透過 <a href="#page-reverse"> 來實現的
</script>

</body>
</html>
